<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <!-- Latest compiled and minified CSS & JS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
      integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
      crossorigin="anonymous"
    />
    <script src="https://code.jquery.com/jquery.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
      integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
      crossorigin="anonymous"
    ></script>

    <!-- Font Awesome Glyphicons -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"
    />

    <title>Friend Finder</title>

    <style>
      #matchImg {
        max-width: 80%;
        max-width: auto;
        display: block;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Survey Questions</h2>
      <hr />

      <h3><strong>About You</strong></h3>
      <h4>Name (Required)</h4>
      <input type="text" name="" id="name" class="form-control" required />

      <h4>Link to Photo Image (Required)</h4>
      <input type="text" name="" id="photo" class="form-control" required />

      <hr />

      <h3><strong>Question 1</strong></h3>
      <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
      <select id="q1" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 2</strong></h3>
      <h4>
        Generally speaking, you rely more on your experience than your
        imagination.
      </h4>
      <select id="q2" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 3</strong></h3>
      <h4>
        You find it easy to stay relaxed and focused even when there is some
        pressure.
      </h4>
      <select id="q3" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 4</strong></h3>
      <h4>You rarely do something just out of sheer curiosity.</h4>
      <select id="q4" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 5</strong></h3>
      <h4>People can rarely upset you.</h4>
      <select id="q5" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 6</strong></h3>
      <h4>
        It is often difficult for you to relate to other people’s feelings.
      </h4>
      <select id="q6" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 7</strong></h3>
      <h4>
        In a discussion, truth should be more important than people’s
        sensitivities.
      </h4>
      <select id="q7" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 8</strong></h3>
      <h4>You rarely get carried away by fantasies and ideas.</h4>
      <select id="q8" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 9</strong></h3>
      <h4>
        You think that everyone’s views should be respected regardless of
        whether they are supported by facts or not.
      </h4>
      <select id="q9" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <h3><strong>Question 10</strong></h3>
      <h4>
        You feel more energetic after spending time with a group of people.
      </h4>
      <select id="q10" class="question-select">
        <option value="">Please select one...</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>

      <br />
      <br />

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn btn-primary btn-lg btn-block"
        id="submit"
      >
        <i class="fa fa-check-circle" aria-hidden="true"></i> Submit
      </button>

      <hr />
      <footer class="footer">
        <div class="container">
          <p>
            <a href="/api/friends">API Friends List</a> |
            <a href="https://github.com/MagentaReds/week-13-FriendFinder"
              >GitHub Repo</a
            >
          </p>
        </div>
      </footer>
    </div>

    <!-- Modal -->
    <div id="resultsModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
            <h2 class="modal-title">
              <strong class="title">Best Match</strong>
            </h2>
          </div>
          <div class="modal-body">
            <h2 class="header"></h2>
            <img id="matchImg" src="" alt="" />
            <p class="body"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    //function to make sure everything is filled out on the form, and all questions answered.
    function isValid() {
      var valid = true;
      $(".form-control").each(function() {
        if ($(this).val() === "") valid = false;
      });
      $(".question-select").each(function() {
        if ($(this).val() === "") valid = false;
      });
      return valid;
    }
    //This function helps us to fill in the modal fields and then displays it.
    function fillModal(title, header, body, photo) {
      $("#resultsModal .title").text(title);
      $("#resultsModal .header").text(header);
      $("#resultsModal .body").text(body);
      $("#resultsModal #matchImg").attr("src", photo);
      $("#resultsModal").modal("show");
    }
    $("#submit").on("click", function() {
      //checking to see if input is valid, and that all questions have been answered
      if (isValid()) {
        var userData = {
          name: $("#name")
            .val()
            .trim(),
          photo: $("#photo")
            .val()
            .trim(),
          scores: [
            $("#q1").val(),
            $("#q2").val(),
            $("#q3").val(),
            $("#q4").val(),
            $("#q5").val(),
            $("#q6").val(),
            $("#q7").val(),
            $("#q8").val(),
            $("#q9").val(),
            $("#q10").val()
          ]
        };
        var baseUrl = window.location.origin;
        //If You happen to be the first person to enter into the database, then there is no one else that can be your buddy, so I made a special case to handle that.
        //I also reuse the modal to display if the user has not answered all the questions and/or not filled out the required input areas.
        $.post(baseUrl + "/api/friends", userData, function(data) {
          var bestie = data.bestFriend;
          if (bestie === null)
            fillModal(
              "No Match Found",
              "You are all alone",
              "Sorry about that",
              ""
            );
          else
            fillModal(
              "Best Match",
              bestie.name,
              "May you get along famously",
              bestie.photo
            );
        });
      } else {
        fillModal(
          "Invalid Input",
          "You missed something",
          "Please answer all questions and check your inputs",
          ""
        );
      }

      return false;
    });
  </script>
</html>
